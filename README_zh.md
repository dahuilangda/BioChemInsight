# BioChemInsight ğŸ§ª

**BioChemInsight** æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¹³å°ï¼Œå¯ä»¥è‡ªåŠ¨ä»ç§‘å­¦æ–‡çŒ®ä¸­æå–åŒ–å­¦ç»“æ„åŠå…¶å¯¹åº”çš„ç”Ÿç‰©æ´»æ€§æ•°æ®ã€‚é€šè¿‡åˆ©ç”¨æ·±åº¦å­¦ä¹ è¿›è¡Œå›¾åƒè¯†åˆ«å’ŒOCRï¼Œå®ƒç®€åŒ–äº†ä¸ºåŒ–å­¦ä¿¡æ¯å­¦ã€æœºå™¨å­¦ä¹ å’Œè¯ç‰©å‘ç°ç ”ç©¶åˆ›å»ºé«˜è´¨é‡ç»“æ„åŒ–æ•°æ®é›†çš„æµç¨‹ã€‚

![logo](images/BioChemInsight.jpeg)

## åŠŸèƒ½ç‰¹æ€§ ğŸ‰

  * **è‡ªåŠ¨åŒ–æ•°æ®æå–** ğŸ”: è‡ªåŠ¨ä» PDF æ–‡æ¡£ä¸­è¯†åˆ«å¹¶æå–åŒ–åˆç‰©ç»“æ„å’Œç”Ÿç‰©æ´»æ€§æ•°æ®ï¼ˆä¾‹å¦‚ IC50, EC50, Kiï¼‰ã€‚
  * **å…ˆè¿›è¯†åˆ«æ ¸å¿ƒ** ğŸ§ : é‡‡ç”¨é¡¶å°–çš„ DECIMER Segmentation æ¨¡å‹è¿›è¡Œå›¾åƒåˆ†æï¼Œå¹¶ä½¿ç”¨ PaddleOCR è¿›è¡Œç¨³å¥çš„æ–‡æœ¬è¯†åˆ«ã€‚
  * **dots_ocr OCR å¼•æ“** ğŸ†•: è‹¥éœ€æ˜¾è‘—æå‡ OCR æ•ˆæœï¼Œå¯é€‰æ‹© `dots_ocr` ä½œä¸º OCR å¼•æ“ã€‚é…ç½®æ–¹æ³•è¯·å‚è€ƒ `DOCKER_DOTS_OCR/README.md`ã€‚æ³¨æ„ï¼šåœ¨ RTX 5090 æ˜¾å¡ä¸Šè¿è¡Œ `dots_ocr` çº¦éœ€ 30GB æ˜¾å­˜ã€‚
  * **æ¨èè§†è§‰æ¨¡å‹**: è§†è§‰æ¨¡å‹æ¨èä½¿ç”¨ **GLM-V4.5** æˆ– **MiniCPM-V-4**ï¼Œæ•ˆæœæœ€ä½³ã€‚
  * **å¤šç§ SMILES å¼•æ“** âš™ï¸: æ”¯æŒåœ¨ **MolScribe**ã€**MolVec** å’Œ **MolNexTR** ä¹‹é—´æ— ç¼åˆ‡æ¢ï¼Œå°†åŒ–å­¦å›¾è°±è½¬æ¢ä¸º SMILES å­—ç¬¦ä¸²ã€‚
  * **çµæ´»çš„é¡µé¢é€‰æ‹©** ğŸ“„: å¯å¤„ç†ç‰¹å®šçš„ã€éè¿ç»­çš„é¡µé¢ï¼ˆä¾‹å¦‚ "1-3, 5, 7-9, 12"ï¼‰ï¼ŒèŠ‚çœæ—¶é—´å’Œè®¡ç®—èµ„æºã€‚
  * **ç»“æ„åŒ–æ•°æ®è¾“å‡º** ğŸ› ï¸: å°†éç»“æ„åŒ–çš„æ–‡æœ¬å’Œå›¾åƒè½¬æ¢ä¸ºå¯ç›´æ¥ç”¨äºåˆ†æçš„æ ¼å¼ï¼Œå¦‚ CSV å’Œ Excelã€‚
  * **ç°ä»£åŒ– Web UI** ğŸŒ: åŸºäº React çš„å‰ç«¯ç•Œé¢é…åˆ FastAPI åç«¯ï¼Œæä¾›ç›´è§‚çš„ PDF å¤„ç†ã€å®æ—¶è¿›åº¦è·Ÿè¸ªå’Œäº¤äº’å¼ç»“æœå¯è§†åŒ–ã€‚
  * **æ™ºèƒ½æ•°æ®åˆå¹¶** ğŸ”—: åŸºäºåŒ–åˆç‰© ID è‡ªåŠ¨åˆå¹¶ç»“æ„å’Œç”Ÿç‰©æ´»æ€§æ•°æ®ï¼Œæä¾›æ— ç¼çš„é›†æˆç»“æœã€‚


## åº”ç”¨åœºæ™¯ ğŸŒŸ

  * **AI/ML æ¨¡å‹è®­ç»ƒ**: ä¸ºåŒ–å­¦ä¿¡æ¯å­¦å’Œç”Ÿç‰©ä¿¡æ¯å­¦é¢†åŸŸçš„é¢„æµ‹æ¨¡å‹ç”Ÿæˆé«˜è´¨é‡çš„è®­ç»ƒæ•°æ®é›†ã€‚
  * **è¯ç‰©å‘ç°**: åŠ é€Ÿæ„æ•ˆå…³ç³»ï¼ˆSARï¼‰ç ”ç©¶å’Œå…ˆå¯¼åŒ–åˆç‰©çš„ä¼˜åŒ–è¿‡ç¨‹ã€‚
  * **è‡ªåŠ¨åŒ–æ–‡çŒ®æŒ–æ˜**: å¤§å¹…å‡å°‘ä»ç§‘å­¦æ–‡ç« ä¸­æ‰‹åŠ¨æ•´ç†æ•°æ®æ‰€éœ€çš„äººåŠ›å’Œæ—¶é—´ã€‚


## å·¥ä½œæµç¨‹ ğŸš€

BioChemInsight é‡‡ç”¨å¤šé˜¶æ®µæµæ°´çº¿å°†åŸå§‹ PDF è½¬æ¢ä¸ºç»“æ„åŒ–æ•°æ®ï¼š

1.  **PDF é¢„å¤„ç†**: å°†è¾“å…¥çš„ PDF æ‹†åˆ†ä¸ºå•ä¸ªé¡µé¢ï¼Œç„¶åå°†è¿™äº›é¡µé¢è½¬æ¢ä¸ºé«˜åˆ†è¾¨ç‡å›¾åƒä»¥ä¾›åˆ†æã€‚
2.  **ç»“æ„æ£€æµ‹**: **DECIMER Segmentation** æ‰«æå›¾åƒï¼Œä»¥å®šä½å’Œåˆ†ç¦»åŒ–å­¦ç»“æ„å›¾ã€‚
3.  **SMILES è½¬æ¢**: é€‰å®šçš„è¯†åˆ«å¼•æ“ï¼ˆ**MolScribe**ã€**MolVec** æˆ– **MolNexTR**ï¼‰å°†åˆ†ç¦»å‡ºçš„å›¾è°±è½¬æ¢ä¸ºæœºå™¨å¯è¯»çš„ SMILES å­—ç¬¦ä¸²ã€‚
4.  **æ ‡è¯†ç¬¦è¯†åˆ«**: è§†è§‰æ¨¡å‹ï¼ˆæ¨èï¼š**GLM-V4.5**ï¼‰è¯†åˆ«ä¸æ¯ä¸ªç»“æ„ç›¸å…³çš„åŒ–åˆç‰©æ ‡è¯†ç¬¦ï¼ˆä¾‹å¦‚ï¼Œâ€œåŒ–åˆç‰© **1**â€ã€â€œ**2a**â€ï¼‰ã€‚
5.  **ç”Ÿç‰©æ´»æ€§æå–**: **PaddleOCR**ï¼ˆå¦‚å·²é…ç½®ä¹Ÿå¯ç”¨ `dots_ocr`ï¼‰ä»æŒ‡å®šçš„å®éªŒé¡µé¢æå–æ–‡æœ¬ï¼Œå¤§å‹è¯­è¨€æ¨¡å‹åˆ™è¾…åŠ©è§£æå’Œæ ‡å‡†åŒ–ç”Ÿç‰©æ´»æ€§ç»“æœã€‚
6.  **æ•°æ®æ•´åˆ**: æ‰€æœ‰æå–çš„ä¿¡æ¯â€”â€”åŒ–åˆç‰©IDã€SMILES å­—ç¬¦ä¸²å’Œç”Ÿç‰©æ´»æ€§æ•°æ®â€”â€”è¢«åˆå¹¶åˆ°ç»“æ„åŒ–æ–‡ä»¶ï¼ˆCSV/Excelï¼‰ä¸­ï¼Œä»¥ä¾¿ä¸‹è½½å’Œè¿›è¡Œä¸‹æ¸¸åˆ†æã€‚


## å®‰è£… ğŸ”§

#### æ­¥éª¤ 1: å…‹éš†ä»£ç ä»“åº“

```bash
git clone https://github.com/dahuilangda/BioChemInsight
cd BioChemInsight
```

#### æ­¥éª¤ 2: é…ç½®å¸¸é‡

é¡¹ç›®éœ€è¦ä¸€ä¸ª `constants.py` æ–‡ä»¶æ¥è®¾ç½®ç¯å¢ƒå˜é‡å’Œè·¯å¾„ã€‚æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶ã€‚

```bash
# é‡å‘½åç¤ºä¾‹æ–‡ä»¶
mv constants_example.py constants.py
```

ç„¶åï¼Œç¼–è¾‘ `constants.py` æ–‡ä»¶ï¼Œè®¾ç½®æ‚¨çš„ API å¯†é’¥ã€æ¨¡å‹è·¯å¾„å’Œå…¶ä»–å¿…è¦é…ç½®ã€‚

#### æ­¥éª¤ 3: åˆ›å»ºå¹¶æ¿€æ´» Conda ç¯å¢ƒ

```bash
conda install -c conda-forge mamba
mamba create -n chem_ocr python=3.10
conda activate chem_ocr
```

#### æ­¥éª¤ 4: å®‰è£…ä¾èµ–

é¦–å…ˆï¼Œå®‰è£…æ”¯æŒ CUDA çš„ PyTorchã€‚

```bash
# å®‰è£… CUDA å·¥å…·å’Œ PyTorch
mamba install -c conda-forge -c nvidia cuda-tools==11.8
mamba install pytorch==2.0.0 torchvision==0.15.0 torchio==2.0.0 pytorch-cuda=11.8 -c pytorch -c nvidia
```

æ¥ä¸‹æ¥ï¼Œå®‰è£…å…¶ä½™çš„ Python åŒ…ã€‚

```bash
# å®‰è£…æ ¸å¿ƒåº“ (ä½¿ç”¨é•œåƒæºä»¥åŠ å¿«ä¸‹è½½é€Ÿåº¦)
pip install decimer-segmentation molscribe -i https://pypi.tuna.tsinghua.edu.cn/simple
mamba install -c conda-forge jupyter pytesseract transformers
pip install PyMuPDF PyPDF2 openai -i https://pypi.tuna.tsinghua.edu.cn/simple

# å®‰è£… Web æœåŠ¡ä¾èµ–
pip install fastapi uvicorn -i https://pypi.tuna.tsinghua.edu.cn/simple

# å®‰è£… Node.js å’Œ npm (ç”¨äºå‰ç«¯)
# åœ¨ Ubuntu/Debian ä¸Š:
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# åœ¨ macOS ä¸Š (ä½¿ç”¨ homebrew):
# brew install node
```


## ä½¿ç”¨æ–¹æ³• ğŸ“–

BioChemInsight å¯ä»¥é€šè¿‡äº¤äº’å¼ç½‘é¡µç•Œé¢æˆ–ç›´æ¥ä»å‘½ä»¤è¡Œæ“ä½œã€‚

> **é‡è¦æç¤ºï¼š** åœ¨å¯åŠ¨æµç¨‹ä¹‹å‰ï¼Œå¿…é¡»ç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ª OCR å¾®æœåŠ¡æ­£åœ¨è¿è¡Œï¼š
> - æ¨èä½¿ç”¨ `DOCKER_PADDLE_OCR`ï¼Œå¹¶åœ¨ `constants.py` ä¸­é…ç½® `PADDLEOCR_SERVER_URL`ã€‚
> - æˆ–è¿è¡Œ `DOCKER_DOTS_OCR`ï¼Œå¹¶é…ç½® `DOTSOCR_SERVER_URL`ã€‚
> æ‚¨å¯ä»¥åŒæ—¶è¿è¡Œä¸¤ä¸ªæœåŠ¡ï¼Œé€šè¿‡è°ƒæ•´ `DEFAULT_OCR_ENGINE` åœ¨å®ƒä»¬ä¹‹é—´åˆ‡æ¢ã€‚

### ç½‘é¡µç•Œé¢ ğŸŒ

åŸºäº React çš„ç°ä»£åŒ–ç½‘é¡µç•Œé¢æä¾›äº†ç›´è§‚çš„æ–‡æ¡£å¤„ç†å¹³å°ï¼Œå…·å¤‡å®æ—¶è¿›åº¦è·Ÿè¸ªåŠŸèƒ½ã€‚

#### å¯åŠ¨ Web æœåŠ¡

**æ­¥éª¤ 1: å¯åŠ¨åç«¯ API æœåŠ¡å™¨**

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œï¼š

```bash
uvicorn frontend.backend.main:app --host 0.0.0.0 --port 8000 --reload
```

**æ­¥éª¤ 2: å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨**

åœ¨æ–°çš„ç»ˆç«¯ä¸­è¿è¡Œï¼š

```bash
cd frontend/ui
npm install
NODE_OPTIONS="--max-old-space-size=8196" npm run dev
```

**æ­¥éª¤ 3: è®¿é—®ç•Œé¢**

åœ¨ç½‘é¡µæµè§ˆå™¨ä¸­æ‰“å¼€ `http://localhost:5173` è®¿é—®ç•Œé¢ã€‚åç«¯ API åœ°å€ä¸º `http://localhost:8000`ã€‚


#### ç½‘é¡µç•Œé¢åŠŸèƒ½

1.  **PDF ä¸Šä¼ **: é€šè¿‡ç›´è§‚ç•Œé¢ä¸Šä¼ å’Œç®¡ç† PDF æ–‡ä»¶ã€‚
2.  **å¯è§†åŒ–é¡µé¢é€‰æ‹©**: ç‚¹å‡»é¡µé¢ç¼©ç•¥å›¾é€‰æ‹©ç»“æ„å’Œæ´»æ€§æå–é¡µé¢ã€‚
3.  **åˆ†æ­¥å¤„ç†æµç¨‹**: 
    - **æ­¥éª¤ 1**: ä¸Šä¼  PDF å¹¶é¢„è§ˆé¡µé¢
    - **æ­¥éª¤ 2**: å®æ—¶è¿›åº¦æ˜¾ç¤ºçš„åŒ–å­¦ç»“æ„æå–
    - **æ­¥éª¤ 3**: åŸºäºç»“æ„çº¦æŸåŒ–åˆç‰©åŒ¹é…çš„ç”Ÿç‰©æ´»æ€§æ•°æ®æå–
    - **æ­¥éª¤ 4**: æŸ¥çœ‹å’Œä¸‹è½½åˆå¹¶ç»“æœ
4.  **å®æ—¶è¿›åº¦è·Ÿè¸ª**: è¯¦ç»†çŠ¶æ€æ›´æ–°çš„æå–è¿›åº¦ç›‘æ§ã€‚
5.  **äº¤äº’å¼ç»“æœ**: æŸ¥çœ‹ã€ç¼–è¾‘å’Œä¸‹è½½ç»“æ„åŒ–æ•°æ®ï¼Œé›†æˆåŒ–åˆç‰©-æ´»æ€§åŒ¹é…ã€‚
6.  **è‡ªåŠ¨æ•°æ®åˆå¹¶**: åŸºäºåŒ–åˆç‰© ID æ— ç¼ç»“åˆç»“æ„å’Œç”Ÿç‰©æ´»æ€§æ•°æ®ã€‚


#### ç½‘é¡µç•Œé¢åŠŸèƒ½

1.  **PDF ä¸Šä¼ **: ä¸Šä¼ æ‚¨å¸Œæœ›å¤„ç†çš„ PDF æ–‡ä»¶ã€‚
2.  **é¡µé¢é€‰æ‹©**: é€šè¿‡ç‚¹å‡»ç¼©ç•¥å›¾æˆ–è¾“å…¥é¡µé¢èŒƒå›´ï¼Œç›´è§‚åœ°é€‰æ‹©ç”¨äºç»“æ„å’Œå®éªŒæ•°æ®æå–çš„é¡µé¢ã€‚
3.  **ç»“æ„æå–**: ç‚¹å‡» **"ç¬¬ä¸€æ­¥: æå–ç»“æ„"** å¼€å§‹åŒ–å­¦ç»“æ„è¯†åˆ«ã€‚
4.  **æ´»æ€§æå–**: è¾“å…¥å®éªŒæ–¹æ³•çš„åç§°ï¼Œé€‰æ‹©ç›¸å…³é¡µé¢ï¼Œç„¶åç‚¹å‡» **"ç¬¬äºŒæ­¥: æå–æ´»æ€§"**ã€‚
5.  **ä¸‹è½½ç»“æœ**: åœ¨ç•Œé¢åº•éƒ¨é¢„è§ˆå’Œä¸‹è½½ç»“æ„åŒ–çš„æ•°æ®è¡¨æ ¼ã€‚

### å‘½ä»¤è¡Œç•Œé¢ (CLI)

å¯¹äºæ‰¹å¤„ç†å’Œè‡ªåŠ¨åŒ–ä»»åŠ¡ï¼Œæ¨èä½¿ç”¨å‘½ä»¤è¡Œç•Œé¢ã€‚

#### å¢å¼ºè¯­æ³• (æ¨è)

æ–°çš„è¯­æ³•æ”¯æŒçµæ´»çš„ã€éè¿ç»­çš„é¡µé¢é€‰æ‹©ã€‚

```bash
python pipeline.py data/sample.pdf \
    --structure-pages "242-267" \
    --assay-pages "270-272" \
    --assay-names "FRET EC50" \
    --engine molnextr \
    --output output
```

**çµæ´»é¡µé¢é€‰æ‹©ç¤ºä¾‹:**

  * **ä»éè¿ç»­é¡µé¢ä¸­æå–ç»“æ„:**
    ```bash
    python pipeline.py data/sample.pdf --structure-pages "242-250,255,260-267" --engine molnextr --output output
    ```
  * **ä»åˆ†æ•£çš„é¡µé¢ä¸­æå–å¤šç§å®éªŒæ•°æ®:**
    ```bash
    python pipeline.py data/sample.pdf --structure-pages "242-267" --assay-pages "30,35,270-272" --assay-names "IC50,FRET EC50" --engine molnextr --output output
    ```

#### æ—§ç‰ˆè¯­æ³• (ä»ç„¶æ”¯æŒ)

ä¸ºäº†å‘åå…¼å®¹ï¼ŒåŸå§‹çš„èµ·å§‹/ç»“æŸé¡µé¢è¯­æ³•ä»ç„¶å¯ç”¨ã€‚

```bash
python pipeline.py data/sample.pdf \
    --structure-start-page 242 \
    --structure-end-page 267 \
    --assay-start-page 270 \
    --assay-end-page 272 \
    --assay-names "FRET EC50" \
    --engine molnextr \
    --output output
```


## è¾“å‡º ğŸ“‚

å¹³å°å°†åœ¨æŒ‡å®šçš„è¾“å‡ºç›®å½•ä¸­ç”Ÿæˆä»¥ä¸‹ç»“æ„åŒ–æ•°æ®æ–‡ä»¶ï¼š

  * `structures.csv`: åŒ…å«æ£€æµ‹åˆ°çš„åŒ–åˆç‰©æ ‡è¯†ç¬¦åŠå…¶å¯¹åº”çš„ SMILES è¡¨ç¤ºã€‚
  * `assay_data.json`: å­˜å‚¨ä¸ºæ¯ä¸ªæŒ‡å®šå®éªŒæå–çš„åŸå§‹ç”Ÿç‰©æ´»æ€§æ•°æ®ã€‚
  * `merged.csv`: ä¸€ä¸ªåˆå¹¶æ–‡ä»¶ï¼Œå°†åŒ–å­¦ç»“æ„ä¸å…¶ç›¸å…³çš„ç”Ÿç‰©æ´»æ€§æ•°æ®æ•´åˆåœ¨ä¸€èµ·ã€‚


## Docker éƒ¨ç½² ğŸ³

åœ¨å®¹å™¨åŒ–ç¯å¢ƒä¸­éƒ¨ç½² BioChemInsight ä»¥ç¡®ä¿ä¸€è‡´æ€§å’Œå¯ç§»æ¤æ€§ã€‚

#### æ­¥éª¤ 1: æ„å»º Docker é•œåƒ

```bash
docker build -t biocheminsight .
```

#### æ­¥éª¤ 2: è¿è¡ŒæœåŠ¡

**é€‰é¡¹ A: å¯åŠ¨ Web åº”ç”¨ (é»˜è®¤)**

è¿è¡Œæ­¤å‘½ä»¤ä»¥å¯åŠ¨ React å‰ç«¯å’Œ FastAPI åç«¯æœåŠ¡ã€‚

```bash
docker run --rm -d --gpus all \
    -p 3000:3000 -p 8000:8000 \
    -e http_proxy="" \
    -e https_proxy="" \
    -v $(pwd)/data:/app/data \
    -v $(pwd)/output:/app/output \
    -v $(pwd)/constants.py:/app/constants.py \
    biocheminsight
```

å¯åŠ¨åï¼Œè®¿é—®ï¼š
- å‰ç«¯ç•Œé¢ï¼š`http://localhost:3000`
- åç«¯ APIï¼š`http://localhost:8000`

**é€‰é¡¹ B: è¿è¡Œå‘½ä»¤è¡Œæµç¨‹**

å¦‚æœæ‚¨éœ€è¦ä½¿ç”¨å‘½ä»¤è¡Œæ‰§è¡Œæ‰¹å¤„ç†ä»»åŠ¡ï¼Œè¯·åœ¨ `docker run` å‘½ä»¤åæŒ‡å®š `python pipeline.py` å’Œç›¸å…³å‚æ•°æ¥è¦†ç›–é»˜è®¤å…¥å£ç‚¹ã€‚

```bash
docker run --rm --gpus all \
    -e http_proxy="" \
    -e https_proxy="" \
    -v $(pwd)/data:/app/data \
    -v $(pwd)/output:/app/output \
    --entrypoint python \
    biocheminsight \
    pipeline.py data/sample.pdf \
    --structure-pages "242-267" \
    --assay-pages "270-272" \
    --assay-names "FRET EC50" \
    --engine molnextr \
    --output output
```

**é€‰é¡¹ C: è¿›å…¥å®¹å™¨è¿›è¡Œäº¤äº’å¼ä¼šè¯**

å¦‚æœéœ€è¦åœ¨å®¹å™¨å†…è¿›è¡Œè°ƒè¯•æˆ–æ‰‹åŠ¨è¿è¡Œå‘½ä»¤ï¼š

```bash
docker run --gpus all -it --rm \
  --entrypoint /bin/bash \
  -e http_proxy="" \
  -e https_proxy="" \
  -v $(pwd)/data:/app/data \
  -v $(pwd)/output:/app/output \
  --name biocheminsight_container \
  biocheminsight
```